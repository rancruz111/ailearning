<!DOCTYPE html>
<html>
<head>
    <title>Communication Training AI Interface</title>
</head>
<body>
    <div id="response">System starting...</div>
    <script>
        // Set up a message listener to receive requests from Storyline
        window.addEventListener('message', function(event) {
            console.log('Received message:', event.data);
            
            // Process the incoming <!DOCTYPE html>
<html>
<head>
    <title>Communication Training AI Interface</title>
</head>
<body>
    <div id="response">System starting...</div>
    <script>
        // Set up our AI communication system
        window.addEventListener('message', async function(event) {
            console.log('Received message:', event.data);
            
            if (event.data.type === 'processInput') {
                const input = event.data.input;
                const scenario = event.data.scenario;
                
                document.getElementById('response').innerText = 
                    'Processing your response...';

                try {
                    // Call Claude's API
                    const response = await fetch('https://api.anthropic.com/v1/messages', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'anthropic-api-key': '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',
                            'anthropic-version': '2023-06-01'
                        },
                        body: JSON.stringify({
                            model: 'claude-3-sonnet-20240229',
                            max_tokens: 1024,
                            messages: [{
                                role: 'system',
                                content: `You are a communication skills trainer helping someone practice giving feedback.
                                         Current scenario: ${scenario}
                                         Respond in character as the team member receiving feedback.
                                         Keep responses brief (2-3 sentences).
                                         Consider:
                                         - How well they demonstrated active listening
                                         - Their clarity of communication
                                         - Their professional tone
                                         - Their problem-solving approach`
                            }, {
                                role: 'user',
                                content: input
                            }]
                        })
                    });

                    const data = await response.json();
                    const aiResponse = data.content[0].text;
                    
                    /message
            if (event.data.type === 'processInput') {
                const input = event.data.input;
                const scenario = event.data.scenario;
                
                console.log('Processing:', input, scenario);
                document.getElementById('response').innerText = 
                    'Processing: ' + input;
                
                // Create our test response
                const response = 'Test response: You said "' + input + 
                    '" about the deadline scenario.';
                
                // Send the response back to Storyline
                window.parent.postMessage({
                    type: 'response',
                    response: response
                }, '*');
            }
        });

        // Signal that we're ready
        document.getElementById('response').innerText = 
            'System ready for input!';
            
        // Tell Storyline we're ready
        window.parent.postMessage({
            type: 'ready',
            status: true
        }, '*');
    </script>
</body>
</html>
